Bootstrap: docker
From: python:3.12-slim

%post
    # Set noninteractive frontend
    export DEBIAN_FRONTEND=noninteractive
    
    # Install system dependencies first
    apt-get update && apt-get install -y \
        wget \
        squashfs-tools \
        cryptsetup \
        && rm -rf /var/lib/apt/lists/*

    # Install apptainer
    export VERSION=1.2.4
    wget https://github.com/apptainer/apptainer/releases/download/v${VERSION}/apptainer_${VERSION}_amd64.deb
    apt-get install -y ./apptainer_${VERSION}_amd64.deb
    rm apptainer_${VERSION}_amd64.deb

    # Install Python packages
    pip install numpy==2.1.0
    pip install python-dotenv==1.0.0
    pip install google-cloud-storage

%environment
    export PYTHONPATH=/opt:$PYTHONPATH

%runscript
    python3 "$@"

